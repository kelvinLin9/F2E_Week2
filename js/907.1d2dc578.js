(self["webpackChunkf2e_week2"]=self["webpackChunkf2e_week2"]||[]).push([[907],{6077:function(t,e,r){var i=r(614),a=String,o=TypeError;t.exports=function(t){if("object"==typeof t||i(t))return t;throw o("Can't set "+a(t)+" as a prototype")}},5787:function(t,e,r){var i=r(7976),a=TypeError;t.exports=function(t,e){if(i(e,t))return t;throw a("Incorrect invocation")}},648:function(t,e,r){var i=r(1694),a=r(614),o=r(4326),s=r(5112),n=s("toStringTag"),c=Object,d="Arguments"==o(function(){return arguments}()),g=function(t,e){try{return t[e]}catch(r){}};t.exports=i?o:function(t){var e,r,i;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=g(e=c(t),n))?r:d?o(e):"Object"==(i=o(e))&&a(e.callee)?"Arguments":i}},3678:function(t){t.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},1060:function(t,e,r){var i=r(1702),a=Error,o=i("".replace),s=function(t){return String(a(t).stack)}("zxcasd"),n=/\n\s*at [^:]*:[^\n]*/,c=n.test(s);t.exports=function(t,e){if(c&&"string"==typeof t&&!a.prepareStackTrace)while(e--)t=o(t,n,"");return t}},9587:function(t,e,r){var i=r(614),a=r(111),o=r(7674);t.exports=function(t,e,r){var s,n;return o&&i(s=e.constructor)&&s!==r&&a(n=s.prototype)&&n!==r.prototype&&o(t,n),t}},6277:function(t,e,r){var i=r(1340);t.exports=function(t,e){return void 0===t?arguments.length<2?"":e:i(t)}},7674:function(t,e,r){var i=r(1702),a=r(9670),o=r(6077);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{t=i(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set),t(r,[]),e=r instanceof Array}catch(s){}return function(r,i){return a(r),o(i),e?t(r,i):r.__proto__=i,r}}():void 0)},1694:function(t,e,r){var i=r(5112),a=i("toStringTag"),o={};o[a]="z",t.exports="[object z]"===String(o)},1340:function(t,e,r){var i=r(648),a=String;t.exports=function(t){if("Symbol"===i(t))throw TypeError("Cannot convert a Symbol value to a string");return a(t)}},2801:function(t,e,r){"use strict";var i=r(2109),a=r(7854),o=r(5005),s=r(9114),n=r(3070).f,c=r(2597),d=r(5787),g=r(9587),l=r(6277),p=r(3678),h=r(1060),u=r(9781),f=r(1913),m="DOMException",E=o("Error"),R=o(m),v=function(){d(this,y);var t=arguments.length,e=l(t<1?void 0:arguments[0]),r=l(t<2?void 0:arguments[1],"Error"),i=new R(e,r),a=E(e);return a.name=m,n(i,"stack",s(1,h(a.stack,1))),g(i,this,v),i},y=v.prototype=R.prototype,I="stack"in E(m),w="stack"in new R(1,2),D=R&&u&&Object.getOwnPropertyDescriptor(a,m),S=!!D&&!(D.writable&&D.configurable),_=I&&!S&&!w;i({global:!0,constructor:!0,forced:f||_},{DOMException:_?v:R});var P=o(m),N=P.prototype;if(N.constructor!==P)for(var T in f||n(N,"constructor",s(1,P)),p)if(c(p,T)){var O=p[T],A=O.s;c(P,A)||n(P,A,s(6,O.c))}},5537:function(t,e,r){"use strict";r(2801),r(7658);var i=r(2578),a=r(1120),o=r(6797),s=r.n(o),n=r(6294);const c=(0,n.Z)();let d=null;e["Z"]=(0,i.Q_)("pdfStore",{state:()=>({event:{},pageNum:1,totalPage:0,scaleXY:100,pdfImage:null,pdfData:null,pdfName:"",pdfHistory:[],fromHistoryData:!1,cacheSearch:""}),actions:{async uploadPDF(t){this.event=t,this.event.target.files[0].size>1e7?alert("檔案超過10MB，請重新選擇"):"application/pdf"==this.event.target.files[0].type?this.analyzePDF():alert("檔案格式錯誤，請重新選擇")},readBlob(t){return new Promise(((e,r)=>{const i=new FileReader;i.addEventListener("load",(()=>e(i.result))),i.addEventListener("error",r),i.readAsDataURL(t)}))},async printPDF(t){const e="data:application/pdf;base64,";pdfjsLib.GlobalWorkerOptions.workerSrc="https://mozilla.github.io/pdf.js/build/pdf.worker.js",t=await this.readBlob(t);const r=atob(t.substring(e.length)),i=await pdfjsLib.getDocument({data:r}).promise;this.totalPage=i.numPages;const a=await i.getPage(this.pageNum),o=a.getViewport({scale:window.devicePixelRatio}),s=document.createElement("canvas"),n=s.getContext("2d");s.height=o.height,s.width=o.width;const c={canvasContext:n,viewport:o},d=a.render(c);return d.promise.then((()=>s))},async pdfToImage(){const t=1/window.devicePixelRatio;return new fabric.Image(this.pdfData,{id:"renderPDF",scaleX:t*this.scaleXY/100,scaleY:t*this.scaleXY/100})},async analyzePDF(){this.pdfData=await this.printPDF(this.event.target.files[0]),console.log(this.pdfData),this.pdfImage=await this.pdfToImage(this.pdfData),console.log(this.pdfImage),c.isLoading=!0,setTimeout((()=>{c.isLoading=!1,this.gotoSign()}),"1000")},async renderPage(){console.log(this.pdfImage),this.pdfImage?(d=new fabric.Canvas("canvas",{fireRightClick:!0,stopContextMenu:!0}),d.requestRenderAll(),d.setWidth(this.pdfImage.width/window.devicePixelRatio*this.scaleXY/100),d.setHeight(this.pdfImage.height/window.devicePixelRatio*this.scaleXY/100),this.fromHistoryData?await d.setBackgroundImage(this.pdfImage.src,d.renderAll.bind(d)):await d.setBackgroundImage(this.pdfImage,d.renderAll.bind(d))):a.Z.push("/")},prevPage(){this.pageNum<=1||(this.pageNum--,this.analyzePDF())},nextPage(){this.pageNum>=this.totalPage||(this.pageNum++,this.analyzePDF())},async zoomOut(){this.scaleXY>50&&(this.scaleXY-=10,this.pdfImage=await this.pdfToImage(this.pdfData),this.renderPage())},async zoomIn(){this.scaleXY<150&&(this.scaleXY+=10,this.pdfImage=await this.pdfToImage(this.pdfData),this.renderPage())},addImage(t){fabric.Image.fromURL(t,(t=>{t.top=400,t.scaleX=.5,t.scaleY=.5,d.add(t)}))},addDate(){const t=s()().format("YYYY/MM/DD"),e=new fabric.Text(t,{top:200,scaleX:1,scaleY:1});d.add(e)},addTextToPDF(t){const e=new fabric.Text(t.value,(t=>{t.top=10,t.left=10,t.scaleX=1,t.scaleY=1}));d.add(e)},removeCanvas(){function t(t){3===t.button&&t.target&&(console.log(t.target),d.remove(t.target))}d.on("mouse:down",t)},downloadPDF(t){const e=new jsPDF,r=d.toDataURL("image/png"),i={};i.pdfImage=this.pdfImage,i.pdfData=this.pdfData,i.pdfName=t,i.pdfYear=(new Date).getFullYear(),i.pdfMonth=(new Date).getMonth(),i.pdfDate=(new Date).getDate(),this.pdfHistory.push(i),localStorage.setItem("pdfHistory",JSON.stringify(this.pdfHistory));const a=e.internal.pageSize.width,o=e.internal.pageSize.height;e.addImage(r,"png",0,0,a,o),e.save(`${t}.pdf`),this.gotoUserHistory()},gotoSign(){a.Z.push("/UserSign/MakeSign")},gotoUserHistory(){a.Z.push("/UserHistory")},getPDFHistory(){this.pdfHistory=JSON.parse(localStorage.getItem("pdfHistory"))||[]},removePDFHistory(t){this.pdfHistory.splice(this.pdfHistory.indexOf(t),1),localStorage.setItem("pdfHistory",JSON.stringify(this.pdfHistory))},fromHistory(){this.totalPage=1,console.log(this.pdfData),this.pdfToImage(),this.renderPage()}},getters:{filterFiles(){return this.pdfHistory.filter((t=>t.pdfName.match(this.cacheSearch)))}}})},6637:function(t,e,r){"use strict";r(7658);var i=r(2578),a=r(1120),o=r(6294);(0,o.Z)();e["Z"]=(0,i.Q_)("signStore",{state:()=>({signs:[],signMethod:"handwriting",imagePreview:"",color:"black"}),actions:{getSign(){this.signs=JSON.parse(localStorage.getItem("signs"))||[];const t=document.querySelector("#canvasImage"),e=t.getContext("2d"),r=document.querySelector(".clear");e.lineWidth=4,e.lineCap="round",e.strokeStyle=this.color;let i=!1;function a(e){const r=t.getBoundingClientRect();return"mousemove"===e.type?{x:e.clientX-r.left,y:e.clientY-r.top}:{x:e.touches[0].clientX-r.left,y:e.touches[0].clientY-r.top}}function o(t){t.preventDefault(),i=!0}function s(){i=!1,e.beginPath()}function n(t){if(!i)return;const r=a(t);e.lineTo(r.x,r.y),e.stroke()}function c(){e.clearRect(0,0,t.width,t.height)}t.addEventListener("mousedown",o),t.addEventListener("mouseup",s),t.addEventListener("mouseleave",s),t.addEventListener("mousemove",n),t.addEventListener("touchstart",o),t.addEventListener("touchend",s),t.addEventListener("touchcancel",s),t.addEventListener("touchmove",n),r.addEventListener("click",c)},saveImage(){if("handwriting"===this.signMethod){const t=document.querySelector("#canvasImage");this.signs.push(t.toDataURL("image/png")),localStorage.setItem("signs",JSON.stringify(this.signs)),this.reset()}else this.signs.push(this.imagePreview),localStorage.setItem("signs",JSON.stringify(this.signs)),this.imagePreview=""},removeImage(t){this.signs.splice(this.signs.indexOf(t),1),localStorage.setItem("signs",JSON.stringify(this.signs))},reset(){const t=document.querySelector("#canvasImage"),e=t.getContext("2d");e.clearRect(0,0,t.width,t.height)},gotoEditPDF(){a.Z.push("/UserSign/EditPDF")},async handleFileUpload(t){try{const e=t.target.files[0];if(!e)return;const r=await this.beforeUpload(e);if(!r.isValid)throw r.errorMessages;this.to64(e)}catch(e){alert(e),console.log("Catch Error: ",e)}finally{t.target.value=""}},beforeUpload(t){return new Promise((e=>{const r=["image/jpeg","image/png"],i=r.includes(t.type),a=[];i||a.push("You can only upload JPG or PNG file!");const o=t.size/1024/1024<2;o||a.push("Image must smaller than 2MB!"),e({isValid:i&&o,errorMessages:a.join("\n")})}))},showPreviewImage(t){const e=URL.createObjectURL(t);this.imagePreview=e},to64(t){const e=new FormData;e.append("iFile",t);const r=e.get("iFile"),i=new FileReader,a=r.type;i.readAsDataURL(r),i.onload=t=>{/^image\/[jpeg|png|gif]/.test(a)&&(console.log(t.target.result),this.imagePreview=t.target.result)}}}})},6294:function(t,e,r){"use strict";var i=r(2578);e["Z"]=(0,i.Q_)("statusStore",{state:()=>({isLoading:!1,signHistoryView:!1}),actions:{}})}}]);
//# sourceMappingURL=907.1d2dc578.js.map